#==================================================
# @ConfigName        Clash Mi Override Config (for Mihomo)
# @Base              HL MihomoParty
# @Author            @HL + GPT-5 ä¼˜åŒ–ç‰ˆ
# @UpdateTime        2025/11/08
# @Function          å®Œæ•´å¯ç”¨é…ç½®ï¼šå…¨å±€ä»£ç† + åˆ†æµç­–ç•¥ + DNSä¼˜åŒ– + å¹¿å‘Šå±è”½ + è‡ªåŠ¨æµ‹é€Ÿ + OpenAI + æµåª’ä½“
#==================================================

mixed-port: 7890
allow-lan: true
bind-address: '*'
mode: rule
log-level: info
ipv6: true
unified-delay: true

external-controller: 127.0.0.1:9090
secret: ""
find-process-mode: strict

# å¯é€‰ UI æ§åˆ¶é¢æ¿ï¼ˆä¾‹å¦‚ mihomo-partyã€yacdã€metacubexdï¼‰
external-ui: /usr/share/mihomo-dashboard

#-----------------------------------
# ğŸ”§ TUN æ¨¡å¼è®¾ç½®ï¼ˆæ¨èå¼€å¯ä»¥æ”¯æŒç³»ç»Ÿçº§ä»£ç†ï¼‰
#-----------------------------------
tun:
  enable: true
  stack: system
  auto-route: true
  auto-detect-interface: true
  dns-hijack:
    - 198.18.0.2:53
  strict-route: false

#-----------------------------------
# ğŸ§  DNS ä¼˜åŒ–ï¼ˆFake-IP æ¨¡å¼ + DoHï¼‰
#-----------------------------------
dns:
  enable: true
  listen: 0.0.0.0:53
  ipv6: true
  use-hosts: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - '*.local'
    - '+.pool.ntp.org'
    - 'time.*.com'
    - 'time.*.gov'
    - 'time.*.edu.cn'
    - '*.ntp.org'
    - '*.ntp.aliyun.com'
  nameserver:
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query
    - https://doh.pub/dns-query
  fallback:
    - https://1.0.0.1/dns-query
    - https://9.9.9.9/dns-query
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
    domain:
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'
      - '+.twitter.com'
      - '+.openai.com'

#-----------------------------------
# ğŸ“¦ ä»£ç†ç­–ç•¥ç»„
#-----------------------------------
proxy-groups:
  - {name: å…¨çƒåŠ é€Ÿ, type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, ç‹®åŸèŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, æ‰‹åŠ¨åˆ‡æ¢, è‡ªåŠ¨é€‰æ‹©, DIRECT]}
  - {name: OpenAi,  type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, ç‹®åŸèŠ‚ç‚¹, æ‰‹åŠ¨åˆ‡æ¢]}
  - {name: å›½é™…åª’ä½“, type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, ç‹®åŸèŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, æ‰‹åŠ¨åˆ‡æ¢, è‡ªåŠ¨é€‰æ‹©, DIRECT]}
  - {name: è°·æ­ŒæœåŠ¡, type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, ç‹®åŸèŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, æ‰‹åŠ¨åˆ‡æ¢, è‡ªåŠ¨é€‰æ‹©, DIRECT]}

  - {name: é¦™æ¸¯èŠ‚ç‚¹, type: url-test, include-all: true, interval: 600, tolerance: 50, filter: "æ¸¯|HK|(?i)Hong"}             
  - {name: æ—¥æœ¬èŠ‚ç‚¹, type: url-test, include-all: true, interval: 600, tolerance: 50, filter: "æ—¥|ä¸œäº¬|JP|(?i)Japan"}
  - {name: ç¾å›½èŠ‚ç‚¹, type: url-test, include-all: true, interval: 600, tolerance: 50, filter: "ç¾|US|(?i)States|American"}
  - {name: ç‹®åŸèŠ‚ç‚¹, type: url-test, include-all: true, interval: 600, tolerance: 50, filter: "æ–°|å¡|SG|(?i)Singapore"}
  - {name: Final, type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, ç‹®åŸèŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, æ‰‹åŠ¨åˆ‡æ¢, è‡ªåŠ¨é€‰æ‹©, DIRECT]}
  - {name: æ‰‹åŠ¨åˆ‡æ¢, type: select, include-all: true}
  - {name: è‡ªåŠ¨é€‰æ‹©, type: url-test, include-all: true, interval: 600, tolerance: 50}
  - {name: AdBlock,  type: select, proxies: [REJECT, DIRECT]}

#-----------------------------------
# ğŸ—‚ï¸ è§„åˆ™é›†ï¼ˆRule Providersï¼‰
#-----------------------------------
rule-providers:
  AdBlock:     
    type: http
    behavior: domain
    format: text
    interval: 86400
    url: https://raw.githubusercontent.com/Cats-Team/AdRules/main/adrules_domainset.txt
    path: ./ruleset/anti-ad-clash.txt 

  OpenAi:      
    type: http
    behavior: classical
    format: yaml
    interval: 86400
    url: https://gist.githubusercontent.com/ddgksf2013/cb4121e8b5c5d865cc949cb8120320c4/raw/Ai.yaml
    path: ./ruleset/OpenAi.yaml

  GlobalMedia: 
    type: http
    behavior: classical
    format: yaml
    interval: 86400
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GlobalMedia/GlobalMedia_Classical.yaml
    path: ./ruleset/GlobalMedia.yaml

  Microsoft:   
    type: http
    behavior: classical
    format: yaml
    interval: 86400
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft.yaml
    path: ./ruleset/Microsoft.yaml

  Google:      
    type: http
    behavior: classical
    format: yaml
    interval: 86400
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml
    path: ./ruleset/Google.yaml

  ProxyLite:   
    type: http
    behavior: classical
    format: yaml
    interval: 86400
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ProxyLite/ProxyLite.yaml
    path: ./ruleset/ProxyLite.yaml

  Direct:      
    type: http
    behavior: classical
    format: yaml
    interval: 86400
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Direct/Direct.yaml
    path: ./ruleset/Direct.yaml

  Lan:         
    type: http
    behavior: classical
    format: yaml
    interval: 86400
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml
    path: ./ruleset/Lan.yaml

  Download:    
    type: http
    behavior: classical
    format: yaml
    interval: 86400
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Download/Download.yaml
    path: ./ruleset/Download.yaml

  ChinaIP:     
    type: http
    behavior: ipcidr
    format: yaml
    interval: 86400
    url: https://raw.githubusercontent.com/soffchen/GeoIP2-CN/release/clash-rule-provider.yml
    path: ./ruleset/ChinaIP.yaml

#-----------------------------------
# ğŸš¦ åˆ†æµè§„åˆ™ï¼ˆRulesï¼‰
#-----------------------------------
rules:
  - RULE-SET,AdBlock,AdBlock
  - RULE-SET,OpenAi,OpenAi
  - RULE-SET,GlobalMedia,å›½é™…åª’ä½“
  - RULE-SET,Microsoft,DIRECT
  - RULE-SET,Google,è°·æ­ŒæœåŠ¡
  - RULE-SET,ProxyLite,å…¨çƒåŠ é€Ÿ
  - RULE-SET,ChinaIP,DIRECT
  - RULE-SET,Direct,DIRECT
  - RULE-SET,Lan,DIRECT
  - RULE-SET,Download,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,Final
